require 'rubygems'
require '../config/environment'
require 'digest/md5'

item = Item.find(339)

imagestring = "images/Save.JPG,images/Save0066.JPG"
images = imagestring.split(",")

item.images = []

images.each do |image|
    # get MD5
    md5 = Digest::MD5.hexdigest(File.read(image))
    activeimage =  Image.find_or_create_by(md5: md5)
    # is a new image
    puts "New image " if activeimage.id == nil
    puts "Existing image " + activeimage.id.to_s  if activeimage.id != nil
    if activeimage.id == nil then
        activeimage.name = item.name
        activeimage.rawimage = File.open(image)
    end
    item.images << activeimage
end
